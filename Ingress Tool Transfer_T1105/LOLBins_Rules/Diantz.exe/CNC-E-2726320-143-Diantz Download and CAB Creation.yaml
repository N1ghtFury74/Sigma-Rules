title: CNC-E-2726320-143-Diantz Download and CAB Creation (Process Creation)
id: 185d7418-f250-42d0-b72e-0c8b70661e93
status: experimental
description: |
  Detects Diantz/Makecab (diantz.exe) used to fetch a remote file via a UNC path and
  compress it into a local .cab archive. Adversaries can abuse SMB/WebDAV sources to
  retrieve content and have diantz.exe write a CAB locally (T1105). Note that this LOLbin can download .cab files and non .cab files 
author: Mohamed Hanii
date: 2025-10-02
references:
  - https://lolbas-project.github.io/lolbas/Binaries/Diantz/
  - https://strontic.github.io/xcyclopedia/library/makecab.exe-B51BF14D7B1D6B5CEE13E90B86A99645.html
  - https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/diantz
tags:
  - attack.command_and_control
  - attack.t1105

logsource:
  product: windows
  category: process_creation

detection:
  # -------- Sysmon (Event ID 1) --------
  sel_sysmon_eid1:
    EventID: 1
  sel_sysmon_image:
    Image|endswith: '\diantz.exe'
  sel_sysmon_ofn:
    OriginalFileName: 'DIANTZ.EXE'
  sel_sysmon_cli_markers:
    CommandLine|contains|all:
      - '\\\\' 
      - '\DavWWWRoot' 
      - '@SSL'

  # -------- Windows Security (Event ID 4688) --------
  sel_4688_eid:
    EventID: 4688
  sel_4688_proc:
    NewProcessName|endswith: '\diantz.exe'
  sel_4688_cli_markers:
    ProcessCommandLine|contains:
      - '\\\\' # UNC source (SMB/WebDAV)
      - '\DavWWWRoot' 
      - '@SSL'

  # Fire when diantz.exe runs and CLI shows remote UNC source + CAB target
  condition: 
    ( sel_sysmon_eid1 and (sel_sysmon_image or sel_sysmon_ofn) and sel_sysmon_cli_markers ) 
    or 
    ( sel_4688_eid and sel_4688_proc and sel_4688_cli_markers )

falsepositives:
  - Administrative packaging tasks that build CABs from files on internal shares (SMB/WebDAV).
  - Build/deployment workflows bundling files into CABs (single file or via DDF).
  - Driver or Windows component distribution using CABs; MSI/setup processes interacting with external CABs.
level: high
