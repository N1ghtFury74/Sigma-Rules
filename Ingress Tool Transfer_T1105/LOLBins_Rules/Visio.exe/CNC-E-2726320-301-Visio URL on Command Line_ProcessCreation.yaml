title: CNC-E-2726320-301-Visio URL on Command Line (Proc Creation)
id: 2726320-301-visio-proc-url
status: test
description: |
  Detects Visio.exe launched with a direct URL in the command line (http/https/ftp/://),
  a LOLBAS-pattern for ingress tool transfer (T1105). Visio.exe is typically used for diagramming
  and does not inherently handle URLs; thus, its invocation with a URL is atypical and warrants investigation.
author: Mohamed Hanii
date: 2025-10-14
references:
  - https://lolbas-project.github.io/lolbas/OtherMSBinaries/Visio/
tags:
  - attack.command_and_control
  - attack.t1105

logsource:
  product: windows
  category: process_creation

detection:
  # ---- Sysmon (EID 1)
  sel_sysmon_eid1:
    EventID: 1
  sel_sysmon_img:
    Image|endswith: '\Visio.exe'
  sel_sysmon_ofn:
    OriginalFileName: 'Visio.exe'
  sel_sysmon_url:
    CommandLine|contains:
      - 'http://'
      - 'https://'
      - 'ftp://'
      - '://'

  # ---- Windows Security (EID 4688)
  sel_4688_eid:
    EventID: 4688
  sel_4688_img:
    NewProcessName|endswith: '\Visio.exe'
  sel_4688_url:
    ProcessCommandLine|contains:
      - 'http://'
      - 'https://'
      - 'ftp://'
      - '://'

  condition: >
    ( sel_sysmon_eid1 and (sel_sysmon_img or sel_sysmon_ofn) and sel_sysmon_url ) or
    ( sel_4688_eid and sel_4688_img and sel_4688_url )


falsepositives:
  - Rare even with remote files as Microsoft Visio or other Office applications access remote resources—such as files hosted on SharePoint or WebDAV servers—the URLs are typically not visible in the command line.
level: high
